{
    "sourceFile": "lib/features/connection/screens/forum_dissosion_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1742910281524,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1742910281524,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\r\nimport 'package:dio/dio.dart';\r\nimport 'discussion_posts_screen.dart';\r\n\r\nclass ForumDiscussionsScreen extends StatefulWidget {\r\n  final String baseUrl;\r\n  final String token;\r\n  final int forumId;\r\n\r\n  const ForumDiscussionsScreen({\r\n    Key? key,\r\n    required this.baseUrl,\r\n    required this.token,\r\n    required this.forumId,\r\n  }) : super(key: key);\r\n\r\n  @override\r\n  State<ForumDiscussionsScreen> createState() => _ForumDiscussionsScreenState();\r\n}\r\n\r\nclass _ForumDiscussionsScreenState extends State<ForumDiscussionsScreen> {\r\n  bool _isLoading = true;\r\n  List _discussions = [];\r\n  final Dio _dio = Dio();\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    fetchDiscussions();\r\n  }\r\n\r\n  Future<void> fetchDiscussions() async {\r\n    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n    try {\r\n      final response = await _dio.get(\r\n        serverUrl,\r\n        queryParameters: {\r\n          'wstoken': widget.token,\r\n          'wsfunction': 'mod_forum_get_forum_discussions',\r\n          'moodlewsrestformat': 'json',\r\n          'forumid': widget.forumId,\r\n        },\r\n      );\r\n      setState(() {\r\n        _discussions = response.data['discussions'] ?? [];\r\n        _isLoading = false;\r\n      });\r\n    } catch (e) {\r\n      print('Error fetching discussions: $e');\r\n      setState(() {\r\n        _isLoading = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      appBar: AppBar(\r\n        title: const Text('Forum Discussions'),\r\n      ),\r\n      body: _isLoading\r\n          ? const Center(child: CircularProgressIndicator())\r\n          : _discussions.isEmpty\r\n              ? const Center(child: Text('No discussions found.'))\r\n              : ListView.builder(\r\n                  itemCount: _discussions.length,\r\n                  itemBuilder: (context, index) {\r\n                    final discussion = _discussions[index];\r\n                    return ListTile(\r\n                      title: Text(discussion['name'] ?? 'No Title'),\r\n                      subtitle: Text('Discussion ID: ${discussion['discussion']}'),\r\n                      onTap: () {\r\n                        // Navigate to DiscussionPostsScreen with discussion id.\r\n                        Navigator.push(\r\n                          context,\r\n                          MaterialPageRoute(\r\n                            builder: (_) => DiscussionPostsScreen(\r\n                              baseUrl: widget.baseUrl,\r\n                              token: widget.token,\r\n                              discussionId: discussion['discussion'],\r\n                            ),\r\n                          ),\r\n                        );\r\n                      },\r\n                    );\r\n                  },\r\n                ),\r\n    );\r\n  }\r\n}\r\n"
        }
    ]
}