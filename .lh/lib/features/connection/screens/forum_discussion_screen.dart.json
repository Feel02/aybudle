{
    "sourceFile": "lib/features/connection/screens/forum_discussion_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 16,
            "patches": [
                {
                    "date": 1742913232270,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1742913290434,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,5 @@\n+import 'package:aybudle/features/connection/screens/module_detail_screen.dart';\r\n import 'package:flutter/material.dart';\r\n import 'package:dio/dio.dart';\r\n import 'discussion_posts_screen.dart';\r\n \r\n"
                },
                {
                    "date": 1742913395238,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,32 +68,22 @@\n                   itemCount: _discussions.length,\r\n                   itemBuilder: (context, index) {\r\n                     final discussion = _discussions[index];\r\n                     return ListTile(\r\n-                      title: Text(module['name'] ?? 'Unnamed Module'),\r\n-                      subtitle: Text('Type: ${module['modname']}, Visible: ${module['visible']}'),\r\n+                      title: Text(discussion['name'] ?? 'Unnamed Discussion'),\r\n+                      subtitle: Text('Posted by: ${discussion['userfullname'] ?? 'Unknown'}'),\r\n                       onTap: () {\r\n-                        if (module['modname'] == 'forum') {\r\n-                          // Try forum-specific handling.\r\n-                          Navigator.push(\r\n-                            context,\r\n-                            MaterialPageRoute(\r\n-                              builder: (_) => ForumDiscussionsScreen(\r\n-                                baseUrl: widget.baseUrl,\r\n-                                token: widget.token,\r\n-                                forumId: module['instance'],\r\n-                              ),\r\n+                        // Navigate to discussion posts\r\n+                        Navigator.push(\r\n+                          context,\r\n+                          MaterialPageRoute(\r\n+                            builder: (_) => DiscussionPostsScreen(\r\n+                              baseUrl: widget.baseUrl,\r\n+                              token: widget.token,\r\n+                              discussionId: discussion['discussion'],\r\n                             ),\r\n-                          );\r\n-                        } else {\r\n-                          // For other types, open a generic detail screen.\r\n-                          Navigator.push(\r\n-                            context,\r\n-                            MaterialPageRoute(\r\n-                              builder: (_) => ModuleDetailScreen(module: module),\r\n-                            ),\r\n-                          );\r\n-                        }\r\n+                          ),\r\n+                        );\r\n                       },\r\n                     );\r\n \r\n                   },\r\n"
                },
                {
                    "date": 1742913581535,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,4 @@\n-import 'package:aybudle/features/connection/screens/module_detail_screen.dart';\r\n import 'package:flutter/material.dart';\r\n import 'package:dio/dio.dart';\r\n import 'discussion_posts_screen.dart';\r\n \r\n@@ -68,12 +67,12 @@\n                   itemCount: _discussions.length,\r\n                   itemBuilder: (context, index) {\r\n                     final discussion = _discussions[index];\r\n                     return ListTile(\r\n-                      title: Text(discussion['name'] ?? 'Unnamed Discussion'),\r\n-                      subtitle: Text('Posted by: ${discussion['userfullname'] ?? 'Unknown'}'),\r\n+                      title: Text(discussion['name'] ?? 'No Title'),\r\n+                      subtitle: Text('Discussion ID: ${discussion['discussion']}'),\r\n                       onTap: () {\r\n-                        // Navigate to discussion posts\r\n+                        // Navigate to DiscussionPostsScreen with discussion id.\r\n                         Navigator.push(\r\n                           context,\r\n                           MaterialPageRoute(\r\n                             builder: (_) => DiscussionPostsScreen(\r\n@@ -84,9 +83,8 @@\n                           ),\r\n                         );\r\n                       },\r\n                     );\r\n-\r\n                   },\r\n                 ),\r\n     );\r\n   }\r\n"
                },
                {
                    "date": 1743062822800,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,5 @@\n+import 'package:aybudle/core/services/api_service.dart';\r\n import 'package:flutter/material.dart';\r\n import 'package:dio/dio.dart';\r\n import 'discussion_posts_screen.dart';\r\n \r\n@@ -20,9 +21,9 @@\n \r\n class _ForumDiscussionsScreenState extends State<ForumDiscussionsScreen> {\r\n   bool _isLoading = true;\r\n   List _discussions = [];\r\n-  final Dio _dio = Dio();\r\n+  final ApiService _apiService = ApiService();\r\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n"
                },
                {
                    "date": 1743062860276,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,19 +32,11 @@\n \r\n   Future<void> fetchDiscussions() async {\r\n     final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n     try {\r\n-      final response = await _dio.get(\r\n-        serverUrl,\r\n-        queryParameters: {\r\n-          'wstoken': widget.token,\r\n-          'wsfunction': 'mod_forum_get_forum_discussions',\r\n-          'moodlewsrestformat': 'json',\r\n-          'forumid': widget.forumId,\r\n-        },\r\n-      );\r\n+      final response = await _apiService.getForumDiscussions(serverUrl, widget.token, widget.forumId);\r\n       setState(() {\r\n-        _discussions = response.data['discussions'] ?? [];\r\n+        _discussions = response['discussions'] ?? [];\r\n         _isLoading = false;\r\n       });\r\n     } catch (e) {\r\n       print('Error fetching discussions: $e');\r\n"
                },
                {
                    "date": 1743062912357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n     final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n     try {\r\n       final response = await _apiService.getForumDiscussions(serverUrl, widget.token, widget.forumId);\r\n       setState(() {\r\n-        _discussions = response['discussions'] ?? [];\r\n+        _discussions = response?['discussions'] ?? [];\r\n         _isLoading = false;\r\n       });\r\n     } catch (e) {\r\n       print('Error fetching discussions: $e');\r\n"
                },
                {
                    "date": 1743062932957,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n     final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n     try {\r\n       final response = await _apiService.getForumDiscussions(serverUrl, widget.token, widget.forumId);\r\n       setState(() {\r\n-        _discussions = response?['discussions'] ?? [];\r\n+        _discussions = response['discussions'];\r\n         _isLoading = false;\r\n       });\r\n     } catch (e) {\r\n       print('Error fetching discussions: $e');\r\n"
                },
                {
                    "date": 1743063133118,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,27 +26,17 @@\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n-    fetchDiscussions();\r\n-  }\r\n-\r\n-  Future<void> fetchDiscussions() async {\r\n-    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n-    try {\r\n-      final response = await _apiService.getForumDiscussions(serverUrl, widget.token, widget.forumId);\r\n+    final fetchDiscussions = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.forumId);\r\n+    fetchDiscussions.then((value) {\r\n       setState(() {\r\n-        _discussions = response['discussions'];\r\n+        _discussions = value['discussions'];\r\n         _isLoading = false;\r\n       });\r\n-    } catch (e) {\r\n-      print('Error fetching discussions: $e');\r\n-      setState(() {\r\n-        _isLoading = false;\r\n-      });\r\n-    }\r\n+    });\r\n   }\r\n-\r\n+  \r\n   @override\r\n   Widget build(BuildContext context) {\r\n     return Scaffold(\r\n       appBar: AppBar(\r\n"
                },
                {
                    "date": 1743063395123,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,17 +26,41 @@\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n-    final fetchDiscussions = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.forumId);\r\n-    fetchDiscussions.then((value) {\r\n+    final discussion = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.discussionId);\r\n+    discussion.then((value) {\r\n       setState(() {\r\n-        _discussions = value['discussions'];\r\n+        _discussionData = value;\r\n         _isLoading = false;\r\n       });\r\n     });\r\n   }\r\n-  \r\n+\r\n+  Future<void> fetchDiscussions() async {\r\n+    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n+    try {\r\n+      final response = await _dio.get(\r\n+        serverUrl,\r\n+        queryParameters: {\r\n+          'wstoken': widget.token,\r\n+          'wsfunction': 'mod_forum_get_forum_discussions',\r\n+          'moodlewsrestformat': 'json',\r\n+          'forumid': widget.forumId,\r\n+        },\r\n+      );\r\n+      setState(() {\r\n+        _discussions = response.data['discussions'] ?? [];\r\n+        _isLoading = false;\r\n+      });\r\n+    } catch (e) {\r\n+      print('Error fetching discussions: $e');\r\n+      setState(() {\r\n+        _isLoading = false;\r\n+      });\r\n+    }\r\n+  }\r\n+\r\n   @override\r\n   Widget build(BuildContext context) {\r\n     return Scaffold(\r\n       appBar: AppBar(\r\n"
                },
                {
                    "date": 1743063450231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,9 +29,9 @@\n     super.initState();\r\n     final discussion = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.discussionId);\r\n     discussion.then((value) {\r\n       setState(() {\r\n-        _discussionData = value;\r\n+        _discussions = value['discussions'] ?? [];\r\n         _isLoading = false;\r\n       });\r\n     });\r\n   }\r\n"
                },
                {
                    "date": 1743063473054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n-    final discussion = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.discussionId);\r\n+    final discussion = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.forumId);\r\n     discussion.then((value) {\r\n       setState(() {\r\n         _discussions = value['discussions'] ?? [];\r\n         _isLoading = false;\r\n"
                },
                {
                    "date": 1743063493674,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,32 +35,8 @@\n       });\r\n     });\r\n   }\r\n \r\n-  Future<void> fetchDiscussions() async {\r\n-    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n-    try {\r\n-      final response = await _dio.get(\r\n-        serverUrl,\r\n-        queryParameters: {\r\n-          'wstoken': widget.token,\r\n-          'wsfunction': 'mod_forum_get_forum_discussions',\r\n-          'moodlewsrestformat': 'json',\r\n-          'forumid': widget.forumId,\r\n-        },\r\n-      );\r\n-      setState(() {\r\n-        _discussions = response.data['discussions'] ?? [];\r\n-        _isLoading = false;\r\n-      });\r\n-    } catch (e) {\r\n-      print('Error fetching discussions: $e');\r\n-      setState(() {\r\n-        _isLoading = false;\r\n-      });\r\n-    }\r\n-  }\r\n-\r\n   @override\r\n   Widget build(BuildContext context) {\r\n     return Scaffold(\r\n       appBar: AppBar(\r\n"
                },
                {
                    "date": 1743063573293,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,15 +26,25 @@\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n-    final discussion = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.forumId);\r\n-    discussion.then((value) {\r\n+    fetchDiscussions();\r\n+  }\r\n+\r\n+  Future<void> fetchDiscussions() async {\r\n+    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n+    try {\r\n+      final response = await _apiService.getForumDiscussions(serverUrl, widget.token, widget.forumId);\r\n       setState(() {\r\n-        _discussions = value['discussions'] ?? [];\r\n+        _discussions = response['discussions'];\r\n         _isLoading = false;\r\n       });\r\n-    });\r\n+    } catch (e) {\r\n+      print('Error fetching discussions: $e');\r\n+      setState(() {\r\n+        _isLoading = false;\r\n+      });\r\n+    }\r\n   }\r\n \r\n   @override\r\n   Widget build(BuildContext context) {\r\n"
                },
                {
                    "date": 1743063704962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,4 @@\n-import 'package:aybudle/core/services/api_service.dart';\r\n import 'package:flutter/material.dart';\r\n import 'package:dio/dio.dart';\r\n import 'discussion_posts_screen.dart';\r\n \r\n@@ -21,9 +20,9 @@\n \r\n class _ForumDiscussionsScreenState extends State<ForumDiscussionsScreen> {\r\n   bool _isLoading = true;\r\n   List _discussions = [];\r\n-  final ApiService _apiService = ApiService();\r\n+  final Dio _dio = Dio();\r\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n@@ -32,11 +31,19 @@\n \r\n   Future<void> fetchDiscussions() async {\r\n     final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n     try {\r\n-      final response = await _apiService.getForumDiscussions(serverUrl, widget.token, widget.forumId);\r\n+      final response = await _dio.get(\r\n+        serverUrl,\r\n+        queryParameters: {\r\n+          'wstoken': widget.token,\r\n+          'wsfunction': 'mod_forum_get_forum_discussions',\r\n+          'moodlewsrestformat': 'json',\r\n+          'forumid': widget.forumId,\r\n+        },\r\n+      );\r\n       setState(() {\r\n-        _discussions = response['discussions'];\r\n+        _discussions = response.data['discussions'] ?? [];\r\n         _isLoading = false;\r\n       });\r\n     } catch (e) {\r\n       print('Error fetching discussions: $e');\r\n"
                },
                {
                    "date": 1743063834927,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,5 @@\n+import 'package:aybudle/core/services/api_service.dart';\r\n import 'package:flutter/material.dart';\r\n import 'package:dio/dio.dart';\r\n import 'discussion_posts_screen.dart';\r\n \r\n@@ -20,38 +21,20 @@\n \r\n class _ForumDiscussionsScreenState extends State<ForumDiscussionsScreen> {\r\n   bool _isLoading = true;\r\n   List _discussions = [];\r\n-  final Dio _dio = Dio();\r\n+  ApiService _apiService = ApiService();\r\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n-    fetchDiscussions();\r\n-  }\r\n-\r\n-  Future<void> fetchDiscussions() async {\r\n-    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n-    try {\r\n-      final response = await _dio.get(\r\n-        serverUrl,\r\n-        queryParameters: {\r\n-          'wstoken': widget.token,\r\n-          'wsfunction': 'mod_forum_get_forum_discussions',\r\n-          'moodlewsrestformat': 'json',\r\n-          'forumid': widget.forumId,\r\n-        },\r\n-      );\r\n+    final discussionForum = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.discussionId);\r\n+    discussionForum.then((value) {\r\n       setState(() {\r\n-        _discussions = response.data['discussions'] ?? [];\r\n+        _discussionData = value;\r\n         _isLoading = false;\r\n       });\r\n-    } catch (e) {\r\n-      print('Error fetching discussions: $e');\r\n-      setState(() {\r\n-        _isLoading = false;\r\n-      });\r\n-    }\r\n+    });\r\n   }\r\n \r\n   @override\r\n   Widget build(BuildContext context) {\r\n"
                },
                {
                    "date": 1743063863879,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,12 +26,12 @@\n \r\n   @override\r\n   void initState() {\r\n     super.initState();\r\n-    final discussionForum = _apiService.getForumDiscussions(widget.baseUrl, widget.token, widget.discussionId);\r\n+    final discussionForum = _apiService.getForumDiscussionsForum(widget.baseUrl, widget.token, widget.forumId);\r\n     discussionForum.then((value) {\r\n       setState(() {\r\n-        _discussionData = value;\r\n+        _discussions = value;\r\n         _isLoading = false;\r\n       });\r\n     });\r\n   }\r\n"
                }
            ],
            "date": 1742913232270,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\r\nimport 'package:dio/dio.dart';\r\nimport 'discussion_posts_screen.dart';\r\n\r\nclass ForumDiscussionsScreen extends StatefulWidget {\r\n  final String baseUrl;\r\n  final String token;\r\n  final int forumId;\r\n\r\n  const ForumDiscussionsScreen({\r\n    Key? key,\r\n    required this.baseUrl,\r\n    required this.token,\r\n    required this.forumId,\r\n  }) : super(key: key);\r\n\r\n  @override\r\n  State<ForumDiscussionsScreen> createState() => _ForumDiscussionsScreenState();\r\n}\r\n\r\nclass _ForumDiscussionsScreenState extends State<ForumDiscussionsScreen> {\r\n  bool _isLoading = true;\r\n  List _discussions = [];\r\n  final Dio _dio = Dio();\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    fetchDiscussions();\r\n  }\r\n\r\n  Future<void> fetchDiscussions() async {\r\n    final String serverUrl = '${widget.baseUrl}/webservice/rest/server.php';\r\n    try {\r\n      final response = await _dio.get(\r\n        serverUrl,\r\n        queryParameters: {\r\n          'wstoken': widget.token,\r\n          'wsfunction': 'mod_forum_get_forum_discussions',\r\n          'moodlewsrestformat': 'json',\r\n          'forumid': widget.forumId,\r\n        },\r\n      );\r\n      setState(() {\r\n        _discussions = response.data['discussions'] ?? [];\r\n        _isLoading = false;\r\n      });\r\n    } catch (e) {\r\n      print('Error fetching discussions: $e');\r\n      setState(() {\r\n        _isLoading = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      appBar: AppBar(\r\n        title: const Text('Forum Discussions'),\r\n      ),\r\n      body: _isLoading\r\n          ? const Center(child: CircularProgressIndicator())\r\n          : _discussions.isEmpty\r\n              ? const Center(child: Text('No discussions found.'))\r\n              : ListView.builder(\r\n                  itemCount: _discussions.length,\r\n                  itemBuilder: (context, index) {\r\n                    final discussion = _discussions[index];\r\n                    return ListTile(\r\n                      title: Text(module['name'] ?? 'Unnamed Module'),\r\n                      subtitle: Text('Type: ${module['modname']}, Visible: ${module['visible']}'),\r\n                      onTap: () {\r\n                        if (module['modname'] == 'forum') {\r\n                          // Try forum-specific handling.\r\n                          Navigator.push(\r\n                            context,\r\n                            MaterialPageRoute(\r\n                              builder: (_) => ForumDiscussionsScreen(\r\n                                baseUrl: widget.baseUrl,\r\n                                token: widget.token,\r\n                                forumId: module['instance'],\r\n                              ),\r\n                            ),\r\n                          );\r\n                        } else {\r\n                          // For other types, open a generic detail screen.\r\n                          Navigator.push(\r\n                            context,\r\n                            MaterialPageRoute(\r\n                              builder: (_) => ModuleDetailScreen(module: module),\r\n                            ),\r\n                          );\r\n                        }\r\n                      },\r\n                    );\r\n\r\n                  },\r\n                ),\r\n    );\r\n  }\r\n}\r\n"
        }
    ]
}